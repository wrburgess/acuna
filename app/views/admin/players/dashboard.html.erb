<%= render Admin::HeaderForIndex::Component.new(
  instance: @instance, 
  controller: params[:controller], 
  action: params[:action], 
  new_button: true, 
  collection_export_xlsx_button: true, 
  show_filtering: true,
  search_box: true) 
%>

<%= render Admin::PageContainer::Component.new do %> 
  <!-- Player Context Filter Navigation -->
  <%= render partial: "filter_context", locals: { params: params, player_type: @player_type } %>

  <!-- Level Filter Navigation -->
  <%= render partial: "filter_levels", locals: { params: params, levels: @levels } %>

  <!-- Status Filter Navigation -->
  <%= render partial: "filter_statuses", locals: { params: params, statuses: @statuses } %>
 
  <!-- Position Filter Navigation -->
  <%= render partial: "filter_positions", locals: { params: params, positions: @positions } %>

  <!-- Tracking List Filter Navigation -->
  <%= render partial: "filter_tracking_lists", locals: { params: params, tracking_lists: @tracking_lists } %>

  <!-- Timeline Filter Navigation -->
  <%= render partial: "filter_timelines", locals: { params: params, timelines: @timelines } %>

  <!-- View Filter Navigation -->
  <%= render partial: "filter_views", locals: { params: params } %>

  <%= render Admin::TableForIndex::Component.new(data: @instances) do |table| %>
    <% table.with_column("Track") do |instance| %>
      <% current_user.tracking_lists.each do |tracking_list| %>
        <% is_tracked = instance.aggregated_tracking_list_ids.include?(tracking_list.id) %>
        <button 
          type="button" 
          class="btn btn-sm p-0"
          data-controller="tracking-list-player"
          data-tracking-list-player-player-id-value="<%= instance.player_id %>"
          data-tracking-list-player-tracking-list-id-value="<%= tracking_list.id %>"
          data-tracking-list-player-tracked-value="<%= is_tracked %>"
          data-tracking-list-name="<%= tracking_list.name %>"
          data-icon-on="<%= tracking_list.icon_name_on %>"
          data-icon-off="<%= tracking_list.icon_name_off %>"
          data-tracking-list-player-target="button"
          data-action="click->tracking-list-player#toggle"
          data-bs-toggle="tooltip" 
          title="<%= is_tracked ? "Remove from #{tracking_list.name}" : "Add to #{tracking_list.name}" %>">
          <i class="<%= is_tracked ? "bi #{tracking_list.icon_name_on} text-warning" : "bi #{tracking_list.icon_name_off} text-muted" %>"></i>
        </button>
      <% end %>
    <% end %>
    <% table.with_column(sort_link([:admin, @q], :last_name, "Player1", class: :base, default_order: :asc)) { |instance| link_to(instance.full_description, profile_admin_player_path(id: instance.player_id)) } %>
    <% table.with_column(sort_link([:admin, @q], :roster_name, "ROS", class: :base)) { |instance| instance.level&.abbreviation } %>
    <% table.with_column(sort_link([:admin, @q], :player_level_weight, "LEVEL", class: :base)) { |instance| instance.level&.abbreviation } %>
    <% table.with_column(sort_link([:admin, @q], :player_status_weight, "STATUS", class: :base)) { |instance| instance.status&.abbreviation } %>
    <% table.with_column(sort_link([:admin, @q], :player_status_weight, "AGE", class: :base)) { |instance| instance.status&.abbreviation } %>
    <% table.with_column(sort_link([:admin, @q], :bat_ops, "OPS", class: :scoring)) { |instance| format_stat(instance.bat_ops, :hundreths) } %>
    <% table.with_column(sort_link([:admin, @q], :bat_hits, "H", class: :stats)) { |instance| format_stat(instance.bat_hits, :hundreths) } %>
    <% table.with_column(sort_link([:admin, @q], :bat_bat_ctrl, "BCTL", class: :scouting)) { |instance| format_stat(instance.bat_bat_ctrl, :hundreths) } %>
  <% end %>

  <%= render Admin::TableForIndex::Component.new(data: @instances) do |table| %>
    <% table.with_column("Track") do |instance| %>
      <% current_user.tracking_lists.each do |tracking_list| %>
        <% is_tracked = instance.aggregated_tracking_list_ids.include?(tracking_list.id) %>
        <button 
          type="button" 
          class="btn btn-sm p-0"
          data-controller="tracking-list-player"
          data-tracking-list-player-player-id-value="<%= instance.player_id %>"
          data-tracking-list-player-tracking-list-id-value="<%= tracking_list.id %>"
          data-tracking-list-player-tracked-value="<%= is_tracked %>"
          data-tracking-list-name="<%= tracking_list.name %>"
          data-icon-on="<%= tracking_list.icon_name_on %>"
          data-icon-off="<%= tracking_list.icon_name_off %>"
          data-tracking-list-player-target="button"
          data-action="click->tracking-list-player#toggle"
          data-bs-toggle="tooltip" 
          title="<%= is_tracked ? "Remove from #{tracking_list.name}" : "Add to #{tracking_list.name}" %>">
          <i class="<%= is_tracked ? "bi #{tracking_list.icon_name_on} text-warning" : "bi #{tracking_list.icon_name_off} text-muted" %>"></i>
        </button>
      <% end %>
    <% end %>
    <% table.with_column(sort_link([:admin, @q], :last_name, "Player1", class: :base, default_order: :asc)) { |instance| link_to(instance.full_description, profile_admin_player_path(id: instance.player_id)) } %>
    <% table.with_column(sort_link([:admin, @q], :roster_name, "ROS", class: :base)) { |instance| instance.level&.abbreviation } %>
    <% table.with_column(sort_link([:admin, @q], :player_level_weight, "LEVEL", class: :base)) { |instance| instance.level&.abbreviation } %>
    <% table.with_column(sort_link([:admin, @q], :player_status_weight, "STATUS", class: :base)) { |instance| instance.status&.abbreviation } %>
    <% table.with_column(sort_link([:admin, @q], :player_status_weight, "AGE", class: :base)) { |instance| instance.status&.abbreviation } %>
    <% table.with_column(sort_link([:admin, @q], :pit_qs, "QS", class: :scoring)) { |instance| format_stat(instance.pit_qs, :integer) } %>
    <% table.with_column(sort_link([:admin, @q], :pit_inn, "INN", class: :stats)) { |instance| format_stat(instance.pit_inn, :integer) } %>
    <% table.with_column(sort_link([:admin, @q], :pit_control_pres, "CNTL", class: :scouting)) { |instance| format_stat(instance.pit_control_pres, :integer) } %>
  <% end %>

  <%= render Admin::IndexPager::Component.new(pagy: @pagy, instance: @instance) %>
<% end %>
